import json

from Reuse import environment
from Reuse import new_platform_api
from Reuse import report_writer


def process():
    # client_secret = os.getenv('CLIENT_SECRET')
    # client_id = os.getenv('CLIENT_ID')

    client_id = environment.get_configuration('get_bearer_token_personal_client_id')
    client_secret = environment.get_configuration('get_bearer_token_personal_client_secret')

    # Always needed minimal scope for new platform
    # scope = 'app-engine:apps:run'
    # scope += ' document:documents:read'
    scope = 'app-engine:apps:run document:documents:read document:documents:delete document:environment-shares:read document:environment-shares:write document:environment-shares:claim document:environment-shares:delete document:direct-shares:read document:direct-shares:write document:direct-shares:delete'

    print('Masked environment variables:')
    print(f'client_secret: {client_secret[:5]}*{client_secret[70:]}')
    print(f'client_id: {client_id[:10]}*')
    print(f'scope: {scope}')

    oauth_bearer_token = new_platform_api.get_oauth_bearer_token(client_id, client_secret, scope)
    results = new_platform_api.get_api(oauth_bearer_token, 'https://lcq01751.apps.dynatrace.com/platform/document/v1/documents')
    documents_json = json.loads(results.text)
    document_list = documents_json.get('documents')
    headers = [['Dashboard Name', 'Dashboard ID']]
    rows = []
    for document in document_list:
        document_type = document.get('type')
        if document_type == 'dashboard':
            document_id = document.get('id')
            document_name = document.get('name')
            rows.append([document_name, document_id])

    report_writer.print_rows(headers, sorted(rows))

    """
    Documents JSON for Dashboards
    {"documents":[{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:03:24.439Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:03:24.439Z"},"access":["read","write","delete"],"id":"099ce6b7-5f51-4894-bc0e-feb7ce733570","name":"List Entity - Custom Device Groups","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:06:29.222Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:06:29.222Z"},"access":["read","write","delete"],"id":"0ddd07de-f328-43df-bec0-f7986a126cd9","name":"$TEMPLATE - List Events  - All Columns","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:08:38.594Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:08:33.118Z"},"access":["read","write","delete"],"id":"15af8790-09c4-41d6-be33-5222a0c2265e","name":"Summarize Events - Active Connectivity Problems By PGI Name","type":"dashboard","version":3,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:07:57.880Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:09:14.339Z"},"access":["read","write","delete"],"id":"45be959e-979f-4528-bed8-40ef699bd25d","name":"Summarize Events - Active Failed Database Connects by Service Name","type":"dashboard","version":3,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:08:58.181Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:07:15.768Z"},"access":["read","write","delete"],"id":"5eae92c6-776c-404f-a325-d9e653524c26","name":"Summarize Events - Browser Global Outage Events (Known Issues Filtered Out)","type":"dashboard","version":4,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:03:45.881Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:03:45.881Z"},"access":["read","write","delete"],"id":"628dbcde-8071-4bfa-8d13-2289453e5a1c","name":"List Entity - Disks","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:09:07.569Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:07:59.358Z"},"access":["read","write","delete"],"id":"642a164d-0a08-45d4-8045-155b0bec76af","name":"Summarize Events - HTTP Global Outages","type":"dashboard","version":3,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:06:41.727Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:06:41.727Z"},"access":["read","write","delete"],"id":"6662c470-295d-4f3e-8c1c-d489f4dd7e14","name":"$TEMPLATE - List Host Groups","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:08:30.419Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:08:51.872Z"},"access":["read","write","delete"],"id":"73c42980-833e-40af-9af5-ddeaff25df1f","name":"Summarize Events - Active Network Problems By PGI Name","type":"dashboard","version":3,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:03:34.323Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:03:34.323Z"},"access":["read","write","delete"],"id":"7c6335d2-c165-422c-ad86-55a2ea35e6f7","name":"List Entity - Custom Devices","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:09:19.500Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:07:41.218Z"},"access":["read","write","delete"],"id":"8499cd9b-341f-4709-b2fa-f3abc7c5b149","name":"Summarize Events - HTTP Global Outages (Known Issues Filtered Out)","type":"dashboard","version":15,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:05:23.152Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:05:23.152Z"},"access":["read","write","delete"],"id":"a4075ffa-8fc1-4858-b924-75ab774e2bca","name":"List Events - All Rows and All Columns","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:04:05.922Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:04:05.922Z"},"access":["read","write","delete"],"id":"b4e59e11-ab30-4754-afa0-370bfc664e7a","name":"List Entity - Network Interfaces","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:04:23.670Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:04:23.670Z"},"access":["read","write","delete"],"id":"c3eef3a8-8347-44bb-aac8-bed07bb99baf","name":"List Events - Active Availability Events","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:05:42.275Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:05:42.275Z"},"access":["read","write","delete"],"id":"d1bd93b8-3b72-43fa-80ea-db6a7a6f8bb3","name":"Summarize Events - By Event Name","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T00:08:49.800Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:08:16.796Z"},"access":["read","write","delete"],"id":"d7487720-dfe3-4452-bd1b-1a66c99bb577","name":"Summarize Events - Browser Global Outage Events","type":"dashboard","version":3,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:01:09.777Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:01:09.777Z"},"access":["read","write","delete"],"id":"ec846e85-e4b2-4103-b1ae-2acf10f8cf91","name":"List Entity - Hosts","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:04:13.297Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:04:13.297Z"},"access":["read","write","delete"],"id":"ed2e839f-e3ba-400c-b3ec-19521e7b411b","name":"List Entity - Operating Systems","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"},{"modificationInfo":{"createdBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","createdTime":"2023-09-22T13:03:55.611Z","lastModifiedBy":"78cfc22b-0015-409e-bb07-0364eecc6ac3","lastModifiedTime":"2023-09-22T13:03:55.611Z"},"access":["read","write","delete"],"id":"f7b64615-4f34-4515-a676-bcfcc38d566c","name":"List Entity - Host Groups","type":"dashboard","version":1,"owner":"78cfc22b-0015-409e-bb07-0364eecc6ac3"}],"nextPageKey":null,"totalCount":19}
    """


if __name__ == '__main__':
    process()
